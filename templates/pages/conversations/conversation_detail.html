{% extends 'base.html' %}

{% load remainder_op %}

{% block page_title %}
    Conversation-{{room}}
{% endblock page_title %}

{% block content %}
    <div class="flex flex-col items-center justify-items-center">
        <div class="w-10/12">
            <div class="grid grid-cols-2 grid-rows-2-200px gap-2 mb-12">
                {% if room.get_first_photo is not None %}
                    <img src="{{room.get_first_photo}}" class="row-span-full rounded-tl-lg rounded-bl-lg h-full w-full bg-cover bg-center" alt="Room Photo">
                {% endif %}
                <div class="grid grid-cols-2 grid-rows-2-200px gap-2">
                    {% for index, photo in room.get_four_photo %}
                        {% remainder_op index as remainder %}
                        <img src="{{photo.file.url}}" class="h-full w-full bg-cover bg-center {% if remainder == 1 %}rounded-tr-lg{% elif remainder == 3 %}rounded-br-lg{% endif %}" alt="Room Photo">
                    {% endfor %}
                </div>
            </div>
            
            <div class="flex flex-col w-full">
                <div class="flex items-center ">
                    <h1 class="text-3xl font-bold mb-4">{{room.name}}</h1>

                </div>
                <div class="flex text-gray-500 mb-5">
                    <div class="rating">
                        <i class="fas fa-star text-red-500"></i>
                        <span class="font-bold">{{room.get_review_points}}</span>
                        <span class=" font-normal">({{room.reviews.count}})</span>
                        <span class="mx-1">&centerdot;</span>
                    </div>
                    {% if room.host.superhost %}
                        <span class="ml-1">Superhost</span>
                        <span class="mx-2">&centerdot;</span>
                    {% endif %}
                    <div class="font-medium">
                        <span class="mr-1">{{room.address}},</span>
                        <span class="mr-1">{{room.city}},</span>
                        <span>{{room.country.name}}</span>
                    </div>
                </div>
            </div>
            <main class="border border-gray-500 p-6 rounded-lg w-1/2">
                <div class="flex items-center justify-center mb-10">
                  {% for participant in conversation.participants.all %}
                    {% include 'mixins/avatar.html' with user=participant %}
                    {% if forloop.first %}
                        <span class="font-bold text-xl mx-6">&</span>
                    {% endif %}
                  {% endfor %}
                </div>
                <div class="flex flex-col">
                    {% for message in conversation.messages.all %}
                      <div class=" {% if message.user.pk == user.pk %}self-end text-right{% endif %}">
                        <div class="mb-2 text-sm font-medium text-gray-600">{{message.user.first_name}}</div>
                        <div class="text-base mb-4 font-medium p-3 rounded-lg max-w-xs
                          {% if message.user.pk == user.pk %}
                              bg-green-500
                              text-white
                          {% else %}
                              bg-gray-300
                          {% endif %}
                        ">
                          {{message.message}}
                        </div>
                      </div>
                    {% endfor %}
                  </div>
                <div class="flex justify-center">
                  <form action="{% url 'conversations:create-message' room.pk conversation.pk %}" class="flex flex-col mt-10 rounded-2xl shadow-lg h-10 w-1/3" method="POST">
                      {% csrf_token %}
                      <input class="text-center outline-none" name="message" placeholder="Write a Message" required />
                  </form>
                </div>
            </main>
        </div>
    </div>
{% endblock content %}